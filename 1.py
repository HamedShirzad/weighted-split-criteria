# ================================================================
# ุณููู ฑ: ุงููพูุฑุช ฺฉุชุงุจุฎุงููโูุง ูพุงู
# ================================================================
# ุงู ุณููู ููุท ฺฉุชุงุจุฎุงููโูุง ุงุตู ููุฑุฏ ูุงุฒ ุจุฑุง ูุฏุฑุช ุฏุงุฏู ู
# ุชุนุงูู ุจุง ุณุณุชู ูุงู ุฑุง ูุงุฑุฏ ูโฺฉูุฏ.

import pandas as pd
import numpy as np
import sys
import os

print("โ ฺฉุชุงุจุฎุงููโูุง ูพุงู (pandas, numpy, sys, os) ุจุง ููููุช ุงููพูุฑุช ุดุฏูุฏ.")

import sys
import os

project_root = os.path.abspath(os.getcwd())
src_path = os.path.join(project_root, 'src')
if src_path not in sys.path:
    sys.path.insert(0, src_path)
    print(f"โ ูุณุฑ '{src_path}' ุจู sys.path ุงุถุงูู ุดุฏ.")
else:
    print(f"โ ูุณุฑ '{src_path}' ุงุฒ ูุจู ุฏุฑ sys.path ูุฌูุฏ ุฏุงุฑุฏ.")

# ================================================================
# ุณููู ฒ: ุงูุฒูุฏู ูุณุฑ ูพุฑูฺู ุจู sys.path
# ================================================================
# ุงู ุณููู ูุณุฑ ูพูุดู 'src' ุฑุง ุจู ูุณุช ูุณุฑูุง ฺฉู ูพุงุชูู ุจุฑุง
# ูพุฏุง ฺฉุฑุฏู ูุงฺููโูุง ุฌุณุชุฌู ูโฺฉูุฏุ ุงุถุงูู ูโฺฉูุฏ.

import sys
import os

try:
    # ูุณุฑ ุฑุดู ูพุฑูฺู ุฑุง ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ุงุฒ ุฑู ูุญู ููุชโุจูฺฉ ูพุฏุง ูโฺฉูู.
    project_root = os.path.abspath(os.getcwd())
    # ูุณุฑ ฺฉุงูู ูพูุดู src ุฑุง ูโุณุงุฒู.
    src_path = os.path.join(project_root, 'src')

    # ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุงุถุงูู ุดุฏู ุชฺฉุฑุงุฑุ ุงุจุชุฏุง ูุฌูุฏ ูุณุฑ ุฑุง ฺฺฉ ูโฺฉูู.
    if src_path not in sys.path:
        sys.path.insert(0, src_path)
        print(f"โ ูุณุฑ '{src_path}' ุจุง ููููุช ุจู sys.path ุงุถุงูู ุดุฏ.")
    else:
        print(f"โ ูุณุฑ '{src_path}' ุงุฒ ูุจู ุฏุฑ sys.path ูุฌูุฏ ุฏุงุฑุฏ.")

except Exception as e:
    print(f"โ ุฎุทุง ุฏุฑ ุชูุธู ูุณุฑ ูพุฑูฺู: {e}")
    print("ูุทูุงู ูุทูุฆู ุดูุฏ ฺฉู ุงู ููุชโุจูฺฉ ุฏุฑ ูพูุดู ุฑุดู ูพุฑูฺู (C:\\Users\\HsH-HsH\\weighted_split_criteria) ูุฑุงุฑ ุฏุงุฑุฏ.")

# ================================================================
# ุณููู ฒ (ุฌุฏุฏ): ุจุงุฑฺฏุฐุงุฑ ูุฌุฏุฏ ู ุงุฌุจุงุฑ ูุงฺููโูุง
# ================================================================
# ุงู ุณููู ุจุฑุง ุญู ูุดฺฉู ฺฉุด ุดุฏู (caching) ูุงฺููโูุง ุฏุฑ ฺููพุชุฑ ุถุฑูุฑ ุงุณุช.
# ุจุง ุงู ฺฉุงุฑุ ูุทูุฆู ูโุดูู ฺฉู ููุดู ุขุฎุฑู ูุณุฎู ุงุฒ ูุงูโูุง ฺฉุฏ ุดูุง ุจุงุฑฺฏุฐุงุฑ ูโุดูุฏ.

import importlib
import sys

# ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุฎุทุงูุง ุงุญุชูุงูุ ูุณุฑูุง ุฑุง ุฏูุจุงุฑู ฺฺฉ ูโฺฉูู
# (ุงูุฌุง ุฑุดุชู ุจู ุดฺฉู raw ุชุนุฑู ุดุฏู ุชุง ุจฺฉโุงุณูุดโูุง ุฏุฑุณุช ุฏุฑ ูุธุฑ ฺฏุฑูุชู ุดููุฏ)
module_path = r'C:\Users\HsH-HsH\weighted_split_criteria\src'
if module_path not in sys.path:
    sys.path.append(module_path)

# ุงููพูุฑุช ูุงฺููโูุง ฺฉู ุฏุฑ ุญุงู ูุฑุงุด ุขูโูุง ูุณุชู
# ุชูุฌู ฺฉูุฏ ฺฉู ูุง ุฎูุฏ ูุงฺูู ุฑุง ุงููพูุฑุช ูโฺฉููุ ูู ฺฉูุงุณ ุฑุง
import custom_tree_classifier.models.decision_tree
import model.weighted_decision_tree

# ุจุงุฑฺฏุฐุงุฑ ูุฌุฏุฏ ู ุงุฌุจุงุฑ ุงู ูุงฺููโูุง ุจุง ุงุณุชูุงุฏู ุงุฒ importlib
# ุงู ุฏุณุชูุฑ ุจู ูพุงุชูู ูโฺฏูุฏ ฺฉู ุญุงูุธู ฺฉุด ุฑุง ูุงุฏุฏู ุจฺฏุฑุฏ ู ูุงู ุฑุง ุงุฒ ูู ุจุฎูุงูุฏ
importlib.reload(custom_tree_classifier.models.decision_tree)
importlib.reload(model.weighted_decision_tree)

# ุญุงูุง ูโุชูุงูู ุจุง ุงุทููุงู ุงุฒ ฺฉูุงุณโูุง ุขูพุฏุช ุดุฏู ุงุณุชูุงุฏู ฺฉูู
# ุงู ุงููพูุฑุช ุจุงุฏ ุญุชูุงู ุจุนุฏ ุงุฒ reload ุงูุฌุงู ุดูุฏ
from model.weighted_decision_tree import WeightedDecisionTreeModel

print("โ ูุงฺููโูุง ุณูุงุฑุด ุจุง ููููุช ู ุจุง ุขุฎุฑู ุชุบุฑุงุช ุจุงุฑฺฏุฐุงุฑ ูุฌุฏุฏ ุดุฏูุฏ.")

# ================================================================
# ุณููู ณ: ุงููพูุฑุช ูุงฺููโูุง ุงุตู ูพุฑูฺู
# ================================================================
# ุฏุฑ ุงู ุณูููุ ูุฏู ุงุตู ู ุชูุงู ุชูุงุจุน ูุนุงุฑ ุชูุณู ุฑุง ฺฉู ุจุฑุง ุณุงุฎุช
# ู ุขููุฒุด ูุฏู ูุงุฒ ุฏุงุฑูุ ุงุฒ ูุณุฑูุง ุตุญุญ ุฏุฑูู ูพูุดู src ุงููพูุฑุช ูโฺฉูู.

try:
    # ุงููพูุฑุช ฺฉูุงุณ ุงุตู ูุฏู ุงุฒ ูุณุฑ: src/model/weighted_decision_tree.py
    from model.weighted_decision_tree import WeightedDecisionTreeModel

    # ุงููพูุฑุช ุชูุงู ฑฑ ุชุงุจุน ูุนุงุฑ ุงุฒ ูุณุฑ: src/criteria/
    from criteria.gini import gini_criterion
    from criteria.qg import gain_ratio_criterion
    from criteria.twoing import twoing_criterion
    from criteria.ng import normalized_gain_criterion
    from criteria.mch import multi_class_hellinger
    from criteria.marsh import marsh_criterion
    from criteria.gs import g_statistic_criterion
    from criteria.dkm import dkm_criterion
    from criteria.cs import chi_squared_criterion
    from criteria.bhy import bhattacharyya_criterion
    from criteria.ks import kolmogorov_smirnov_criterion

    print("โ ูุฏู ุงุตู ู ุชูุงู ฑฑ ูุนุงุฑ ุชูุณู ุจุง ููููุช ุงููพูุฑุช ุดุฏูุฏ.")
    print("ุขูุงุฏู ุจุฑุง ุจุงุฑฺฏุฐุงุฑ ุฏุงุฏูโูุง ู ุณุงุฎุช ูุฏู.")

except ImportError as e:
    print(f"โ ุฎุทุง ุฏุฑ ุงููพูุฑุช ูุงฺููโูุง ูพุฑูฺู: {e}")
    print("ุงู ุฎุทุง ูุนูููุงู ุจู ุฏูู ุนุฏู ุงุฌุฑุง ููููุชโุขูุฒ ุณููู ูุจู (ุชูุธู ูุณุฑ) ุฑุฎ ูโุฏูุฏ.")
except Exception as e:
    print(f"โ ฺฉ ุฎุทุง ุบุฑููุชุธุฑู ุฑุฎ ุฏุงุฏ: {e}")

# ================================================================
# ุณููู ด: ุจุงุฑฺฏุฐุงุฑ ู ุขูุงุฏูโุณุงุฒ ุฏุงุฏูโูุง
# ================================================================
# ุฏุฑ ุงู ุณูููุ ุฏุชุงุณุช ุงูุชุฎุงุจ ุดุฏู ุชูุณุท ุดูุง (sample_dataset_30_numeric.csv)
# ุงุฒ ูุงู CSV ุฎูุงูุฏู ู ุจุฑุง ุขููุฒุด ูุฏู ุขูุงุฏู ูโุดูุฏ.

import pandas as pd
import numpy as np

try:
    # ูุณุฑ ุฏุชุงุณุช ุฑุง ูุดุฎุต ูโฺฉูู.
    # ุจุง ุชูุฌู ุจู ุงูุชุฎุงุจ ุดูุงุ ุงู ูุงู ุจุงุฏ ุฏุฑ ุฑุดู ูพุฑูฺู ูุฑุงุฑ ุฏุงุดุชู ุจุงุดุฏ.
    dataset_path = 'sample_dataset_30_numeric.csv'

    # ุฎูุงูุฏู ูุงู CSV ุจุง ุงุณุชูุงุฏู ุงุฒ pandas
    df = pd.read_csv(dataset_path)

    print(f"โ ุฏุชุงุณุช '{dataset_path}' ุจุง ููููุช ุจุงุฑฺฏุฐุงุฑ ุดุฏ.")
    print("\n--- ุงุทูุงุนุงุช ุงููู ุฏุชุงุณุช ---")
    print(f"ุดฺฉู ุฏุชุงุณุช (ุชุนุฏุงุฏ ุณุทุฑูุง ู ุณุชููโูุง): {df.shape}")
    print("\nต ุณุทุฑ ุงูู ุฏุชุงุณุช:")
    # ููุงุด ต ุณุทุฑ ุงูู ุจุฑุง ุจุฑุฑุณ ุตุญุช ุฏุงุฏูโูุง
    print(df.head())

    # --- ุขูุงุฏูโุณุงุฒ ุฏุงุฏูโูุง ุจุฑุง ูุฏู ---
    # ุชูุงู ุณุชููโูุง ุจู ุฌุฒ ุณุชูู ุขุฎุฑ ุจู ุนููุงู ูฺฺฏโูุง (X) ุฏุฑ ูุธุฑ ฺฏุฑูุชู ูโุดููุฏ.
    X = df.iloc[:, :-1]
    # ุณุชูู ุขุฎุฑ ุจู ุนููุงู ูุชุบุฑ ูุฏู (y) ุฏุฑ ูุธุฑ ฺฏุฑูุชู ูโุดูุฏ.
    y = df.iloc[:, -1]

    # ุชุจุฏู ุฏุชุงูุฑูโูุง pandas ุจู ุขุฑุงูโูุง NumPy
    X_np = X.to_numpy()
    y_np = y.to_numpy()

    print("\nโ ุฏุงุฏูโูุง ุจุง ููููุช ุจู ูุฑูุช NumPy ุชุจุฏู ุดุฏูุฏ ู ุจุฑุง ุขููุฒุด ุขูุงุฏู ูุณุชูุฏ.")
    print(f"ุดฺฉู ูุงุชุฑุณ ูฺฺฏโูุง (X): {X_np.shape}")
    print(f"ุดฺฉู ุจุฑุฏุงุฑ ูุฏู (y): {y_np.shape}")

except FileNotFoundError:
    print(f"โ ุฎุทุง: ูุงู ุฏุชุงุณุช ุฏุฑ ูุณุฑ '{dataset_path}' ูพุฏุง ูุดุฏ.")
    print("ูุทูุงู ูุทูุฆู ุดูุฏ ฺฉู ูุงู ูุงู ุตุญุญ ุงุณุช ู ุฏุฑ ูพูุดู ุฑุดู ูพุฑูฺู ูุฑุงุฑ ุฏุงุฑุฏ.")
except Exception as e:
    print(f"โ ฺฉ ุฎุทุง ุบุฑููุชุธุฑู ุฏุฑ ููฺฏุงู ูพุฑุฏุงุฒุด ุฏุงุฏูโูุง ุฑุฎ ุฏุงุฏ: {e}")

# ================================================================
# ุณููู ต: ุขูุงุฏูโุณุงุฒ ูุณุช ูุนุงุฑูุง ุชุฑฺฉุจ
# ================================================================
# ุฏุฑ ุงู ุณูููุ ูุณุช ุงุฒ ุชุงูพูโูุง (ูุงู ูุนุงุฑุ ุชุงุจุน ูุนุงุฑ) ุฑุง ูโุณุงุฒู.
# ุงู ูุณุช ุจู ุนููุงู ูุฑูุฏ ุจู ูุฏู ูุง ุฏุงุฏู ุฎูุงูุฏ ุดุฏ ุชุง ุจุฏุงูุฏ ุงุฒ ฺฉุฏุงู
# ูุนุงุฑูุง ุจุฑุง ุณุงุฎุช ุฏุฑุฎุช ุชุตูู ุงุณุชูุงุฏู ฺฉูุฏ.

try:
    all_criteria = [
        ("gini", gini_criterion),
        ("gain_ratio", gain_ratio_criterion),
        ("twoing", twoing_criterion),
        ("normalized_gain", normalized_gain_criterion),
        ("multi_class_hellinger", multi_class_hellinger),
        ("marshall", marsh_criterion),
        ("g_statistic", g_statistic_criterion),
        ("dkm", dkm_criterion),
        ("chi_squared", chi_squared_criterion),
        ("bhattacharyya", bhattacharyya_criterion),
        ("kolmogorov_smirnov", kolmogorov_smirnov_criterion),
    ]

    print("โ ูุณุช ูุนุงุฑูุง ุจุง ููููุช ุณุงุฎุชู ุดุฏ.")
    print(f"   - ุชุนุฏุงุฏ ฺฉู ูุนุงุฑูุง: {len(all_criteria)}")
    print("ุงู ูุณุช ุขูุงุฏู ุงุณุช ุชุง ุจู ุนููุงู ูุฑูุฏ ุจู ูุฏู ุฏุงุฏู ุดูุฏ.")

except:
    pass  # ูุฑ ุงุชูุงู ุงูุชุงุฏุ ูุงุฏุฏู ุจฺฏุฑ

# ================================================================
# ุณููู ถ (ูุณุฎู ุฏุจุงฺฏ - ุจุฏูู try-except ู ุจุง print ุงุตูุงุญ ุดุฏู)
# ================================================================
# ุงู ูุณุฎู ุงุฒ ุณูููุ ุจููฺฉ try-except ุฑุง ูุฏุงุฑุฏ ุชุง ุจุชูุงูู
# ฺฏุฒุงุฑุด ุฎุทุง ฺฉุงูู ูพุงุชูู ุฑุง ูุดุงูุฏู ฺฉูู.

print("\n--- ุดุฑูุน ูุฑุขูุฏ ุณุงุฎุช ููููู ูุฏู (ุญุงูุช ุฏุจุงฺฏ) ---")

# ฺฉ ููููู ุงุฒ ูุฏู ุดูุง ุฑุง ูโุณุงุฒู.
model = WeightedDecisionTreeModel(
    criteria_funcs_weights=all_criteria,
    max_depth=3,
    a=X_np
)

print("โ ฺฉ ููููู ุงุฒ ูุฏู WeightedDecisionTreeModel ุจุง ููููุช ุณุงุฎุชู ุดุฏ.")
# ๐ฅ ุงุตูุงุญู: ูุณุฑ ุฏุณุชุฑุณ ุจู max_depth ุงุตูุงุญ ุดุฏ
print(f"   - ุญุฏุงฺฉุซุฑ ุนูู ุชูุธู ุดุฏู: {model.max_depth}")
print(f"   - ุชุนุฏุงุฏ ูุนุงุฑูุง ุชุฑฺฉุจ: {len(model.criteria)}")

print("\nูุฏู ุขูุงุฏู ุจุฑุง ุขููุฒุด ุฏุฑ ุณููู ุจุนุฏ ุงุณุช.")

# ================================================================
# ุณููู ท (ูุณุฎู ุฏุจุงฺฏ - ุจุฏูู try-except): ุขููุฒุด ูุฏู
# ================================================================
# ุงู ูุณุฎู ุจุฑุง ุฏุจุงฺฏ ุฏูู ุงุณุช ู ูฺ ุฎุทุง ุฑุง ูุฏุฑุช ููโฺฉูุฏ.

print("--- ุดุฑูุน ูุฑุขูุฏ ุขููุฒุด ูุฏู (fit) ---")

# ูุฑุงุฎูุงู ูุชุฏ fit ุจุฑุง ุดุฑูุน ูุฑุขูุฏ ุณุงุฎุช ุฏุฑุฎุช ุชุตูู.
# ุงฺฏุฑ ุฎุทุง ุฑุฎ ุฏูุฏุ ุฏุฑ ุงู ุฎุท ูุชููู ุฎูุงูุฏ ุดุฏ.
model.fit(X_np, y_np)

print("\n--- โ ุขููุฒุด ูุฏู ุจุง ููููุช ุจู ูพุงุงู ุฑุณุฏ ---")
